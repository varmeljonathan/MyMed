<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker - myMed</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #5D5CDE;
            --primary-light: rgba(93, 92, 222, 0.1);
            --primary-dark: #4847b0;
            --text-main: #333333;
            --text-secondary: #666666;
            --text-light: #808080;
            --border-color: #dddddd;
            --card-bg: #ffffff;
            --bg-color: #f5f5f5;
            --section-divide: #eeeeee;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --bp-normal: #28a745;
            --bp-elevated: #ffc107;
            --bp-stage1: #ff9800;
            --bp-stage2: #dc3545;
            --bg-normal: #28a745;
            --bg-prediabetes: #ffc107;
            --bg-diabetes: #dc3545;
            
            /* Dark mode colors */
            --dark-bg: #1e1e1e;
            --dark-card-bg: #2d2d2d;
            --dark-text-main: #e0e0e0;
            --dark-text-secondary: #b0b0b0;
            --dark-text-light: #909090;
            --dark-border-color: #444444;
            --dark-section-divide: #3a3a3a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text-main);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px 75px 20px;
            flex: 1;
            width: 100%;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .app-title i {
            margin-right: 10px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--section-divide);
            color: var(--text-main);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dark-mode .section-title {
            border-bottom-color: var(--dark-section-divide);
            color: var(--dark-text-main);
        }
        
        .section-title .add-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .section-title .add-btn i {
            margin-right: 5px;
        }
        
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .dark-mode .card {
            background-color: var(--dark-card-bg);
            border-color: var(--dark-border-color);
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .dark-mode .tabs {
            border-bottom-color: var(--dark-border-color);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            position: relative;
            color: var(--text-secondary);
        }
        
        .dark-mode .tab {
            color: var(--dark-text-secondary);
        }
        
        .tab.active {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form fields */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
            background-color: var(--card-bg);
            color: var(--text-main);
        }
        
        .dark-mode .form-control {
            background-color: var(--dark-bg);
            border-color: var(--dark-border-color);
            color: var(--dark-text-main);
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(93, 92, 222, 0.1);
        }
        
        .form-hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        .dark-mode .form-hint {
            color: var(--dark-text-light);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border-radius: 4px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--text-main);
        }
        
        .dark-mode .btn-secondary {
            background-color: var(--dark-bg);
            color: var(--dark-text-main);
        }
        
        /* Dashboard styles */
        .dashboard-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .dashboard-card {
            flex: 1;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background-color: #ccc;
            transition: background-color 0.3s;
        }
        
        .normal-bp::before, .normal-bg::before {
            background-color: var(--bp-normal);
        }
        
        .elevated-bp::before, .prediabetes-bg::before {
            background-color: var(--bp-elevated);
        }
        
        .stage1-bp::before {
            background-color: var(--bp-stage1);
        }
        
        .stage2-bp::before, .diabetes-bg::before {
            background-color: var(--bp-stage2);
        }
        
        .dark-mode .dashboard-card {
            background-color: var(--dark-card-bg);
            border-color: var(--dark-border-color);
        }
        
        .dashboard-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .dark-mode .dashboard-title {
            color: var(--dark-text-secondary);
        }
        
        .dashboard-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .dashboard-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .dark-mode .dashboard-label {
            color: var(--dark-text-light);
        }
        
        /* BP status colors */
        .normal-bp .dashboard-value {
            color: var(--bp-normal);
        }
        
        .elevated-bp .dashboard-value {
            color: var(--bp-elevated);
        }
        
        .stage1-bp .dashboard-value {
            color: var(--bp-stage1);
        }
        
        .stage2-bp .dashboard-value {
            color: var(--bp-stage2);
        }
        
        /* Glucose status colors */
        .normal-bg .dashboard-value {
            color: var(--bg-normal);
        }
        
        .prediabetes-bg .dashboard-value {
            color: var(--bg-prediabetes);
        }
        
        .diabetes-bg .dashboard-value {
            color: var(--bg-diabetes);
        }
        
        /* Readings list */
        .readings-list {
            margin-top: 20px;
        }
        
        .reading-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .reading-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 5px;
            transition: background-color 0.3s;
        }
        
        .reading-normal::before {
            background-color: var(--bp-normal);
        }
        
        .reading-elevated::before {
            background-color: var(--bp-elevated);
        }
        
        .reading-stage1::before {
            background-color: var(--bp-stage1);
        }
        
        .reading-stage2::before {
            background-color: var(--bp-stage2);
        }
        
        .dark-mode .reading-item {
            border-bottom-color: var(--dark-border-color);
        }
        
        .reading-item:last-child {
            border-bottom: none;
        }
        
        .reading-date {
            width: 80px;
            color: var(--text-secondary);
            flex-shrink: 0;
            font-size: 0.9rem;
        }
        
        .dark-mode .reading-date {
            color: var(--dark-text-secondary);
        }
        
        .reading-time {
            width: 70px;
            color: var(--text-secondary);
            flex-shrink: 0;
            font-size: 0.9rem;
        }
        
        .dark-mode .reading-time {
            color: var(--dark-text-secondary);
        }
        
        .reading-value {
            flex: 1;
            display: flex;
            align-items: center;
            font-size: 1rem;
        }
        
        .reading-primary {
            font-weight: 500;
            margin-right: 10px;
        }
        
        .reading-additional {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .dark-mode .reading-additional {
            color: var(--dark-text-secondary);
        }
        
        .reading-status {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
            color: white;
            margin-left: 10px;
        }
        
        .status-normal {
            background-color: var(--bp-normal);
        }
        
        .status-elevated {
            background-color: var(--bp-elevated);
        }
        
        .status-stage1 {
            background-color: var(--bp-stage1);
        }
        
        .status-stage2 {
            background-color: var(--bp-stage2);
        }
        
        .reading-actions {
            margin-left: 10px;
            color: var(--text-light);
            cursor: pointer;
        }
        
        .dark-mode .reading-actions {
            color: var(--dark-text-light);
        }
        
        /* Status legend */
        .status-legend {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .dark-mode .legend-item {
            color: var(--dark-text-secondary);
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .legend-normal {
            background-color: var(--bp-normal);
        }
        
        .legend-elevated {
            background-color: var(--bp-elevated);
        }
        
        .legend-stage1 {
            background-color: var(--bp-stage1);
        }
        
        .legend-stage2 {
            background-color: var(--bp-stage2);
        }
        
        /* Empty state */
        .empty-state {
            padding: 30px;
            text-align: center;
            color: var(--text-light);
            font-style: italic;
        }
        
        .dark-mode .empty-state {
            color: var(--dark-text-light);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            padding: 10px 0;
            z-index: 100;
        }
        
        .dark-mode .bottom-nav {
            background-color: var(--dark-card-bg);
            border-top-color: var(--dark-border-color);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--text-secondary);
            transition: color 0.2s;
            padding: 5px 0;
        }
        
        .nav-item.active {
            color: var(--primary-color);
        }
        
        .dark-mode .nav-item {
            color: var(--dark-text-secondary);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 3px;
        }
        
        .nav-text {
            font-size: 0.75rem;
        }
        
        /* Toast notification */
        .toast-container {
            position: fixed;
            bottom: 75px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
        
        .toast {
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            min-width: 250px;
            max-width: 350px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .toast.toast-visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .dark-mode .toast {
            background-color: var(--dark-card-bg);
        }
        
        .toast.success {
            border-left: 4px solid var(--success-color);
        }
        
        .toast.error {
            border-left: 4px solid var(--danger-color);
        }
        
        .toast.info {
            border-left: 4px solid var(--primary-color);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .toast-icon {
            margin-right: 12px;
        }
        
        .toast.success .toast-icon {
            color: var(--success-color);
        }
        
        .toast.error .toast-icon {
            color: var(--danger-color);
        }
        
        .toast.info .toast-icon {
            color: var(--primary-color);
        }
        
        .toast.warning .toast-icon {
            color: var(--warning-color);
        }
        
        .credit-footer {
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 20px;
            padding-bottom: 10px;
            width: 100%;
        }
        
        .dark-mode .credit-footer {
            color: var(--dark-text-light);
        }
        
        /* Back button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 20px;
        }
        
        .back-btn i {
            margin-right: 5px;
        }
        
        .dark-mode .back-btn {
            color: var(--dark-text-secondary);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1 class="app-title">
                <i class="fas fa-heartbeat"></i> Health Tracker
            </h1>
        </div>
    </div>

    <div class="container">
        <a href="home.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab" id="bp-tab" data-tab="bp">Blood Pressure</div>
            <div class="tab" id="glucose-tab" data-tab="glucose">Blood Glucose</div>
        </div>
        
        <!-- Blood Pressure Tab -->
        <div class="tab-content" id="bp-content">
            <!-- Status Legend -->
            <div class="status-legend">
                <div class="legend-item">
                    <div class="legend-color legend-normal"></div>
                    <span>Normal</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-elevated"></div>
                    <span>Elevated</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-stage1"></div>
                    <span>Stage 1</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-stage2"></div>
                    <span>Stage 2</span>
                </div>
            </div>
        
            <!-- Dashboard -->
            <div class="dashboard-row">
                <div class="dashboard-card normal-bp" id="systolic-card">
                    <div class="dashboard-title">Systolic</div>
                    <div class="dashboard-value">--</div>
                    <div class="dashboard-label">mmHg</div>
                </div>
                
                <div class="dashboard-card normal-bp" id="diastolic-card">
                    <div class="dashboard-title">Diastolic</div>
                    <div class="dashboard-value">--</div>
                    <div class="dashboard-label">mmHg</div>
                </div>
                
                <div class="dashboard-card" id="pulse-card">
                    <div class="dashboard-title">Pulse</div>
                    <div class="dashboard-value">--</div>
                    <div class="dashboard-label">bpm</div>
                </div>
            </div>
            
            <!-- Add Reading Form -->
            <div class="card">
                <div class="card-body">
                    <h3 style="margin-bottom: 15px;">Add Blood Pressure Reading</h3>
                    <form id="bp-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="systolic" class="form-label">Systolic (mmHg)</label>
                                <input type="number" id="systolic" class="form-control" required min="70" max="250" placeholder="120">
                                <div class="form-hint">Top number</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="diastolic" class="form-label">Diastolic (mmHg)</label>
                                <input type="number" id="diastolic" class="form-control" required min="40" max="150" placeholder="80">
                                <div class="form-hint">Bottom number</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pulse" class="form-label">Pulse (bpm)</label>
                                <input type="number" id="pulse" class="form-control" min="40" max="200" placeholder="75">
                                <div class="form-hint">Optional</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="bp-notes" class="form-label">Notes</label>
                                <input type="text" id="bp-notes" class="form-control" placeholder="Any additional information...">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="clear-bp-btn" class="btn btn-secondary">Clear</button>
                            <button type="button" id="save-bp-btn" class="btn btn-primary">Save Reading</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- BP Readings List -->
            <div class="section-title">
                Recent Readings
            </div>
            <div class="card">
                <div id="bp-readings-list" class="readings-list">
                    <div id="empty-bp" class="empty-state">
                        <p>No blood pressure readings recorded yet</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Blood Glucose Tab -->
        <div class="tab-content" id="glucose-content">
            <!-- Status Legend -->
            <div class="status-legend">
                <div class="legend-item">
                    <div class="legend-color legend-normal"></div>
                    <span>Normal</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-elevated"></div>
                    <span>Prediabetes</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-stage2"></div>
                    <span>Diabetes</span>
                </div>
            </div>
        
            <!-- Dashboard -->
            <div class="dashboard-row">
                <div class="dashboard-card normal-bg" id="glucose-card">
                    <div class="dashboard-title">Blood Glucose</div>
                    <div class="dashboard-value">--</div>
                    <div class="dashboard-label">mg/dL</div>
                </div>
                
                <div class="dashboard-card" id="a1c-card">
                    <div class="dashboard-title">Est. A1C</div>
                    <div class="dashboard-value">--</div>
                    <div class="dashboard-label">%</div>
                </div>
                
                <div class="dashboard-card" id="avg-glucose-card">
                    <div class="dashboard-title">Average</div>
                    <div class="dashboard-value">--</div>
                    <div class="dashboard-label">mg/dL</div>
                </div>
            </div>
            
            <!-- Add Reading Form -->
            <div class="card">
                <div class="card-body">
                    <h3 style="margin-bottom: 15px;">Add Blood Glucose Reading</h3>
                    <form id="glucose-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="glucose-value" class="form-label">Blood Glucose (mg/dL)</label>
                                <input type="number" id="glucose-value" class="form-control" required min="20" max="600" placeholder="100">
                            </div>
                            
                            <div class="form-group">
                                <label for="glucose-type" class="form-label">Reading Type</label>
                                <select id="glucose-type" class="form-control" required>
                                    <option value="fasting">Fasting</option>
                                    <option value="before_meal">Before Meal</option>
                                    <option value="after_meal">After Meal (2hr)</option>
                                    <option value="bedtime">Bedtime</option>
                                    <option value="random">Random</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="glucose-notes" class="form-label">Notes</label>
                                <input type="text" id="glucose-notes" class="form-control" placeholder="Any additional information...">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="clear-glucose-btn" class="btn btn-secondary">Clear</button>
                            <button type="button" id="save-glucose-btn" class="btn btn-primary">Save Reading</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Glucose Readings List -->
            <div class="section-title">
                Recent Readings
            </div>
            <div class="card">
                <div id="glucose-readings-list" class="readings-list">
                    <div id="empty-glucose" class="empty-state">
                        <p>No blood glucose readings recorded yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Credit Footer -->
    <div class="credit-footer">
        by Venegda Mel
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="home.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span class="nav-text">Home</span>
        </a>
        <a href="reminders.html" class="nav-item">
            <i class="fas fa-bell"></i>
            <span class="nav-text">Reminders</span>
        </a>
        <a href="reports.html" class="nav-item">
            <i class="fas fa-chart-line"></i>
            <span class="nav-text">Reports</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span class="nav-text">Profile</span>
        </a>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const currentUser = checkUserLogin();
            if (!currentUser) return;
            
            // Check for dark mode
            checkDarkMode();
            
            // Set up tabs
            setupTabs();
            
            // Process hash to determine active tab
            processHash();
            
            // Load BP data
            loadBPData();
            
            // Load glucose data
            loadGlucoseData();
            
            // Set up form handling
            setupFormHandling();
            
            // Function to check if user is logged in
            function checkUserLogin() {
                try {
                    const userJson = sessionStorage.getItem('myMed_currentUser');
                    if (!userJson) {
                        window.location.href = 'login.html';
                        return null;
                    }
                    return JSON.parse(userJson);
                } catch (err) {
                    console.error('Error checking login status:', err);
                    window.location.href = 'login.html';
                    return null;
                }
            }
            
            // Function to check dark mode
            function checkDarkMode() {
                const darkModeEnabled = localStorage.getItem('myMed_darkMode') === 'true';
                const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (darkModeEnabled || (localStorage.getItem('myMed_darkMode') === null && systemPrefersDark)) {
                    document.body.classList.add('dark-mode');
                }
            }
            
            // Process hash to determine active tab
            function processHash() {
                const hash = window.location.hash.substring(1);
                if (hash === 'bp' || hash === 'glucose') {
                    activateTab(hash);
                } else {
                    // Default to BP
                    activateTab('bp');
                }
                
                // Update hash when tabs change
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        window.location.hash = this.dataset.tab;
                    });
                });
            }
            
            // Tab switching
            function setupTabs() {
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabName = this.dataset.tab;
                        activateTab(tabName);
                    });
                });
            }
            
            function activateTab(tabName) {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to selected tab
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // Show corresponding content
                document.getElementById(`${tabName}-content`).classList.add('active');
            }
            
            // Load BP data
            function loadBPData() {
                try {
                    // Get BP readings
                    const bpReadings = JSON.parse(localStorage.getItem('myMed_bp_readings')) || [];
                    const userBPReadings = bpReadings.filter(reading => reading.userId === currentUser.id);
                    
                    // Sort by date, most recent first
                    userBPReadings.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    // Update dashboard
                    updateBPDashboard(userBPReadings);
                    
                    // Display readings
                    displayBPReadings(userBPReadings);
                } catch (err) {
                    console.error('Error loading BP data:', err);
                    showToast('Error loading blood pressure data', 'error');
                }
            }
            
            // Update BP dashboard
            function updateBPDashboard(readings) {
                if (readings.length === 0) {
                    // No readings yet
                    document.getElementById('systolic-card').querySelector('.dashboard-value').textContent = '--';
                    document.getElementById('diastolic-card').querySelector('.dashboard-value').textContent = '--';
                    document.getElementById('pulse-card').querySelector('.dashboard-value').textContent = '--';
                    return;
                }
                
                // Get most recent reading
                const latestReading = readings[0];
                
                // Update values
                document.getElementById('systolic-card').querySelector('.dashboard-value').textContent = latestReading.systolic;
                document.getElementById('diastolic-card').querySelector('.dashboard-value').textContent = latestReading.diastolic;
                
                if (latestReading.pulse) {
                    document.getElementById('pulse-card').querySelector('.dashboard-value').textContent = latestReading.pulse;
                } else {
                    document.getElementById('pulse-card').querySelector('.dashboard-value').textContent = '--';
                }
                
                // Update status classes based on BP category
                updateBPStatusClasses(latestReading.systolic, latestReading.diastolic);
            }
            
            // Update BP status classes
            function updateBPStatusClasses(systolic, diastolic) {
                const systolicCard = document.getElementById('systolic-card');
                const diastolicCard = document.getElementById('diastolic-card');
                
                // Remove all status classes
                systolicCard.classList.remove('normal-bp', 'elevated-bp', 'stage1-bp', 'stage2-bp');
                diastolicCard.classList.remove('normal-bp', 'elevated-bp', 'stage1-bp', 'stage2-bp');
                
                // Add appropriate classes based on BP category
                const category = getBPCategory(systolic, diastolic);
                
                switch (category) {
                    case 'normal':
                        systolicCard.classList.add('normal-bp');
                        diastolicCard.classList.add('normal-bp');
                        break;
                    case 'elevated':
                        systolicCard.classList.add('elevated-bp');
                        diastolicCard.classList.add('normal-bp');
                        break;
                    case 'stage1':
                        systolicCard.classList.add('stage1-bp');
                        diastolicCard.classList.add('stage1-bp');
                        break;
                    case 'stage2':
                        systolicCard.classList.add('stage2-bp');
                        diastolicCard.classList.add('stage2-bp');
                        break;
                }
            }
            
            // Display BP readings
            function displayBPReadings(readings) {
                const readingsList = document.getElementById('bp-readings-list');
                const emptyBP = document.getElementById('empty-bp');
                
                // Clear list (except empty message)
                Array.from(readingsList.children).forEach(child => {
                    if (child !== emptyBP) {
                        child.remove();
                    }
                });
                
                // Show empty message if no readings
                if (readings.length === 0) {
                    emptyBP.style.display = 'block';
                    return;
                }
                
                // Hide empty message
                emptyBP.style.display = 'none';
                
                // Display readings
                readings.forEach(reading => {
                    const readingDate = new Date(reading.date);
                    
                    const item = document.createElement('div');
                    const category = getBPCategory(reading.systolic, reading.diastolic);
                    item.className = 'reading-item reading-' + category;
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    switch (category) {
                        case 'normal':
                            statusClass = 'status-normal';
                            statusText = 'Normal';
                            break;
                        case 'elevated':
                            statusClass = 'status-elevated';
                            statusText = 'Elevated';
                            break;
                        case 'stage1':
                            statusClass = 'status-stage1';
                            statusText = 'Stage 1';
                            break;
                        case 'stage2':
                            statusClass = 'status-stage2';
                            statusText = 'Stage 2';
                            break;
                    }
                    
                    item.innerHTML = `
                        <div class="reading-date">
                            ${readingDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                        </div>
                        <div class="reading-time">
                            ${readingDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}
                        </div>
                        <div class="reading-value">
                            <div class="reading-primary">${reading.systolic}/${reading.diastolic}</div>
                            <div class="reading-additional">
                                ${reading.pulse ? `Pulse: ${reading.pulse} bpm` : ''}
                            </div>
                            <div class="reading-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="reading-actions" data-id="${reading.id}">
                            <i class="fas fa-trash-alt"></i>
                        </div>
                    `;
                    
                    // Add delete event listener
                    const deleteBtn = item.querySelector('.reading-actions');
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const readingId = this.dataset.id;
                        if (confirm('Are you sure you want to delete this reading?')) {
                            deleteBPReading(readingId);
                        }
                    });
                    
                    readingsList.appendChild(item);
                });
            }
            
            // Load glucose data
            function loadGlucoseData() {
                try {
                    // Get glucose readings
                    const glucoseReadings = JSON.parse(localStorage.getItem('myMed_glucose_readings')) || [];
                    const userGlucoseReadings = glucoseReadings.filter(reading => reading.userId === currentUser.id);
                    
                    // Sort by date, most recent first
                    userGlucoseReadings.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    // Update dashboard
                    updateGlucoseDashboard(userGlucoseReadings);
                    
                    // Display readings
                    displayGlucoseReadings(userGlucoseReadings);
                } catch (err) {
                    console.error('Error loading glucose data:', err);
                    showToast('Error loading blood glucose data', 'error');
                }
            }
            
            // Update glucose dashboard
            function updateGlucoseDashboard(readings) {
                if (readings.length === 0) {
                    // No readings yet
                    document.getElementById('glucose-card').querySelector('.dashboard-value').textContent = '--';
                    document.getElementById('a1c-card').querySelector('.dashboard-value').textContent = '--';
                    document.getElementById('avg-glucose-card').querySelector('.dashboard-value').textContent = '--';
                    return;
                }
                
                // Get most recent reading
                const latestReading = readings[0];
                
                // Calculate average
                const sum = readings.reduce((total, reading) => total + reading.value, 0);
                const avgGlucose = Math.round(sum / readings.length);
                
                // Calculate estimated A1C
                // Formula: A1C = (Average Blood Glucose + 46.7) / 28.7
                const estimatedA1C = ((avgGlucose + 46.7) / 28.7).toFixed(1);
                
                // Update values
                document.getElementById('glucose-card').querySelector('.dashboard-value').textContent = latestReading.value;
                document.getElementById('a1c-card').querySelector('.dashboard-value').textContent = estimatedA1C;
                document.getElementById('avg-glucose-card').querySelector('.dashboard-value').textContent = avgGlucose;
                
                // Update status classes based on glucose category
                updateGlucoseStatusClasses(latestReading.value);
            }
            
            // Update glucose status classes
            function updateGlucoseStatusClasses(glucose) {
                const glucoseCard = document.getElementById('glucose-card');
                
                // Remove all status classes
                glucoseCard.classList.remove('normal-bg', 'prediabetes-bg', 'diabetes-bg');
                
                // Add appropriate class based on glucose category
                const category = getGlucoseCategory(glucose);
                
                switch (category) {
                    case 'normal':
                        glucoseCard.classList.add('normal-bg');
                        break;
                    case 'prediabetes':
                        glucoseCard.classList.add('prediabetes-bg');
                        break;
                    case 'diabetes':
                        glucoseCard.classList.add('diabetes-bg');
                        break;
                }
            }
            
            // Display glucose readings
            function displayGlucoseReadings(readings) {
                const readingsList = document.getElementById('glucose-readings-list');
                const emptyGlucose = document.getElementById('empty-glucose');
                
                // Clear list (except empty message)
                Array.from(readingsList.children).forEach(child => {
                    if (child !== emptyGlucose) {
                        child.remove();
                    }
                });
                
                // Show empty message if no readings
                if (readings.length === 0) {
                    emptyGlucose.style.display = 'block';
                    return;
                }
                
                // Hide empty message
                emptyGlucose.style.display = 'none';
                
                // Display readings
                readings.forEach(reading => {
                    const readingDate = new Date(reading.date);
                    
                    const item = document.createElement('div');
                    const category = getGlucoseCategory(reading.value);
                    item.className = 'reading-item reading-' + (category === 'normal' ? 'normal' : 
                                    category === 'prediabetes' ? 'elevated' : 'stage2');
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    switch (category) {
                        case 'normal':
                            statusClass = 'status-normal';
                            statusText = 'Normal';
                            break;
                        case 'prediabetes':
                            statusClass = 'status-elevated';
                            statusText = 'Prediabetes';
                            break;
                        case 'diabetes':
                            statusClass = 'status-stage2';
                            statusText = 'Diabetes';
                            break;
                    }
                    
                    // Format reading type
                    let typeText = '';
                    switch (reading.type) {
                        case 'fasting': typeText = 'Fasting'; break;
                        case 'before_meal': typeText = 'Before Meal'; break;
                        case 'after_meal': typeText = 'After Meal'; break;
                        case 'bedtime': typeText = 'Bedtime'; break;
                        case 'random': typeText = 'Random'; break;
                        default: typeText = reading.type;
                    }
                    
                    item.innerHTML = `
                        <div class="reading-date">
                            ${readingDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                        </div>
                        <div class="reading-time">
                            ${readingDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}
                        </div>
                        <div class="reading-value">
                            <div class="reading-primary">${reading.value} mg/dL</div>
                            <div class="reading-additional">
                                ${typeText}
                            </div>
                            <div class="reading-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="reading-actions" data-id="${reading.id}">
                            <i class="fas fa-trash-alt"></i>
                        </div>
                    `;
                    
                    // Add delete event listener
                    const deleteBtn = item.querySelector('.reading-actions');
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const readingId = this.dataset.id;
                        if (confirm('Are you sure you want to delete this reading?')) {
                            deleteGlucoseReading(readingId);
                        }
                    });
                    
                    readingsList.appendChild(item);
                });
            }
            
            // Set up form handling
            function setupFormHandling() {
                // BP form
                document.getElementById('save-bp-btn').addEventListener('click', saveBPReading);
                document.getElementById('clear-bp-btn').addEventListener('click', function() {
                    document.getElementById('bp-form').reset();
                });
                
                // Glucose form
                document.getElementById('save-glucose-btn').addEventListener('click', saveGlucoseReading);
                document.getElementById('clear-glucose-btn').addEventListener('click', function() {
                    document.getElementById('glucose-form').reset();
                });
            }
            
            // Save BP reading
            function saveBPReading() {
                try {
                    // Get form values
                    const systolic = parseInt(document.getElementById('systolic').value);
                    const diastolic = parseInt(document.getElementById('diastolic').value);
                    const pulse = document.getElementById('pulse').value ? parseInt(document.getElementById('pulse').value) : null;
                    const notes = document.getElementById('bp-notes').value;
                    
                    // Validate
                    if (!systolic || !diastolic) {
                        showToast('Please enter both systolic and diastolic values', 'error');
                        return;
                    }
                    
                    // Create reading object
                    const reading = {
                        id: 'bp_' + Date.now(),
                        userId: currentUser.id,
                        systolic,
                        diastolic,
                        pulse,
                        date: new Date().toISOString(),
                        notes,
                        createdAt: new Date().toISOString()
                    };
                    
                    // Get existing readings
                    const bpReadings = JSON.parse(localStorage.getItem('myMed_bp_readings')) || [];
                    
                    // Add new reading
                    bpReadings.push(reading);
                    
                    // Save to localStorage
                    localStorage.setItem('myMed_bp_readings', JSON.stringify(bpReadings));
                    
                    // Reset form
                    document.getElementById('bp-form').reset();
                    
                    // Show success message
                    showToast('Blood pressure reading saved', 'success');
                    
                    // Reload data
                    loadBPData();
                } catch (err) {
                    console.error('Error saving BP reading:', err);
                    showToast('Error saving blood pressure reading', 'error');
                }
            }
            
            // Delete BP reading
            function deleteBPReading(readingId) {
                try {
                    // Get existing readings
                    const bpReadings = JSON.parse(localStorage.getItem('myMed_bp_readings')) || [];
                    
                    // Filter out the reading to delete
                    const updatedReadings = bpReadings.filter(reading => reading.id !== readingId);
                    
                    // Save to localStorage
                    localStorage.setItem('myMed_bp_readings', JSON.stringify(updatedReadings));
                    
                    // Show success message
                    showToast('Blood pressure reading deleted', 'success');
                    
                    // Reload data
                    loadBPData();
                } catch (err) {
                    console.error('Error deleting BP reading:', err);
                    showToast('Error deleting blood pressure reading', 'error');
                }
            }
            
            // Save glucose reading
            function saveGlucoseReading() {
                try {
                    // Get form values
                    const value = parseInt(document.getElementById('glucose-value').value);
                    const type = document.getElementById('glucose-type').value;
                    const notes = document.getElementById('glucose-notes').value;
                    
                    // Validate
                    if (!value || !type) {
                        showToast('Please enter both value and type', 'error');
                        return;
                    }
                    
                    // Create reading object
                    const reading = {
                        id: 'gluc_' + Date.now(),
                        userId: currentUser.id,
                        value,
                        type,
                        date: new Date().toISOString(),
                        notes,
                        createdAt: new Date().toISOString()
                    };
                    
                    // Get existing readings
                    const glucoseReadings = JSON.parse(localStorage.getItem('myMed_glucose_readings')) || [];
                    
                    // Add new reading
                    glucoseReadings.push(reading);
                    
                    // Save to localStorage
                    localStorage.setItem('myMed_glucose_readings', JSON.stringify(glucoseReadings));
                    
                    // Reset form
                    document.getElementById('glucose-form').reset();
                    
                    // Show success message
                    showToast('Blood glucose reading saved', 'success');
                    
                    // Reload data
                    loadGlucoseData();
                } catch (err) {
                    console.error('Error saving glucose reading:', err);
                    showToast('Error saving blood glucose reading', 'error');
                }
            }
            
            // Delete glucose reading
            function deleteGlucoseReading(readingId) {
                try {
                    // Get existing readings
                    const glucoseReadings = JSON.parse(localStorage.getItem('myMed_glucose_readings')) || [];
                    
                    // Filter out the reading to delete
                    const updatedReadings = glucoseReadings.filter(reading => reading.id !== readingId);
                    
                    // Save to localStorage
                    localStorage.setItem('myMed_glucose_readings', JSON.stringify(updatedReadings));
                    
                    // Show success message
                    showToast('Blood glucose reading deleted', 'success');
                    
                    // Reload data
                    loadGlucoseData();
                } catch (err) {
                    console.error('Error deleting glucose reading:', err);
                    showToast('Error deleting blood glucose reading', 'error');
                }
            }
            
            // Get BP category
            function getBPCategory(systolic, diastolic) {
                if (systolic < 120 && diastolic < 80) {
                    return 'normal';
                } else if (systolic >= 120 && systolic <= 129 && diastolic < 80) {
                    return 'elevated';
                } else if ((systolic >= 130 && systolic <= 139) || (diastolic >= 80 && diastolic <= 89)) {
                    return 'stage1';
                } else if (systolic >= 140 || diastolic >= 90) {
                    return 'stage2';
                }
                
                return 'normal'; // Default fallback
            }
            
            // Get glucose category
            function getGlucoseCategory(glucose) {
                // Based on fasting blood glucose values
                if (glucose < 100) {
                    return 'normal';
                } else if (glucose >= 100 && glucose <= 125) {
                    return 'prediabetes';
                } else if (glucose >= 126) {
                    return 'diabetes';
                }
                
                return 'normal'; // Default fallback
            }
            
            // Toast notification function
            function showToast(message, type = 'info', duration = 3000) {
                let toastContainer = document.querySelector('.toast-container');
                
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.className = 'toast-container';
                    document.body.appendChild(toastContainer);
                }
                
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                let iconClass = 'fa-info-circle';
                if (type === 'success') iconClass = 'fa-check-circle';
                if (type === 'error') iconClass = 'fa-exclamation-circle';
                if (type === 'warning') iconClass = 'fa-exclamation-triangle';
                
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="toast-message">${message}</div>
                `;
                
                toastContainer.appendChild(toast);
                
                // Trigger animation
                setTimeout(() => {
                    toast.classList.add('toast-visible');
                }, 10);
                
                // Remove after duration
                setTimeout(() => {
                    toast.classList.remove('toast-visible');
                    
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, duration);
            }
        });
    </script>
</body>
</html>